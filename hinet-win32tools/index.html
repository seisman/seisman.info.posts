<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Hi-net win32tools - SeisMan</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="SeisMan"><meta name=description content="从 Hi-net 获取的波形数据为不常见/用的WIN32 格式，Hi-net 提供了 win32tools 来实现波形数据的基本处理和转换。
"><meta name=keywords content="地球物理学,地震学,SAC,软件,开源"><meta name=generator content="Hugo 0.82.0 with theme even"><link rel=canonical href=https://blog.seisman.info/hinet-win32tools/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/dist/even.c2a46f00.min.css rel=stylesheet><link href=/lib/fancybox/jquery.fancybox-3.1.20.min.css rel=stylesheet><meta property="og:title" content="Hi-net win32tools"><meta property="og:description" content="从 Hi-net 获取的波形数据为不常见/用的WIN32 格式，Hi-net 提供了 win32tools 来实现波形数据的基本处理和转换。"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.seisman.info/hinet-win32tools/"><meta property="article:section" content="post"><meta property="article:published_time" content="2014-09-07T00:00:00+00:00"><meta property="article:modified_time" content="2014-12-01T00:00:00+00:00"><meta itemprop=name content="Hi-net win32tools"><meta itemprop=description content="从 Hi-net 获取的波形数据为不常见/用的WIN32 格式，Hi-net 提供了 win32tools 来实现波形数据的基本处理和转换。"><meta itemprop=datePublished content="2014-09-07T00:00:00+00:00"><meta itemprop=dateModified content="2014-12-01T00:00:00+00:00"><meta itemprop=wordCount content="2504"><meta itemprop=keywords content="Hinet,格式转换,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hi-net win32tools"><meta name=twitter:description content="从 Hi-net 获取的波形数据为不常见/用的WIN32 格式，Hi-net 提供了 win32tools 来实现波形数据的基本处理和转换。"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>SeisMan</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>首页</li></a><a href=/post/><li class=mobile-menu-item>归档</li></a><a href=/categories/><li class=mobile-menu-item>分类</li></a><a href=/tags/><li class=mobile-menu-item>标签</li></a><a href=https://seismo-learn.org/links/><li class=mobile-menu-item>链接</li></a><a href=http://seisman.qiniudn.com/seisman-blog.pdf><li class=mobile-menu-item>PDF</li></a><a href=/collections/><li class=mobile-menu-item>合集</li></a><a href=/donations/><li class=mobile-menu-item>捐赠</li></a><a href=/about/><li class=mobile-menu-item>关于</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>SeisMan</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>首页</a></li><li class=menu-item><a class=menu-item-link href=/post/>归档</a></li><li class=menu-item><a class=menu-item-link href=/categories/>分类</a></li><li class=menu-item><a class=menu-item-link href=/tags/>标签</a></li><li class=menu-item><a class=menu-item-link href=https://seismo-learn.org/links/>链接</a></li><li class=menu-item><a class=menu-item-link href=http://seisman.qiniudn.com/seisman-blog.pdf>PDF</a></li><li class=menu-item><a class=menu-item-link href=/collections/>合集</a></li><li class=menu-item><a class=menu-item-link href=/donations/>捐赠</a></li><li class=menu-item><a class=menu-item-link href=/about/>关于</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Hi-net win32tools</h1><div class=post-meta><span class=post-time>2014-09-07</span><div class=post-category><a href=/categories/%E5%9C%B0%E9%9C%87%E5%AD%A6%E5%9F%BA%E7%A1%80/>地震学基础</a></div></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#下载>下载</a></li><li><a href=#tools>Tools</a><ul><li><a href=#catwin32>catwin32</a></li><li><a href=#win2sac_32>win2sac_32</a></li><li><a href=#dewin_32>dewin_32</a></li><li><a href=#其他>其他</a></li></ul></li><li><a href=#小结>小结</a></li><li><a href=#修订历史>修订历史</a></li></ul></nav></div></div><div class=post-content><p>从 Hi-net 获取的波形数据为不常见/用的WIN32 格式，Hi-net 提供了 win32tools 来实现波形数据的基本处理和转换。</p><h2 id=下载>下载</h2><p>下载地址： <a href="http://www.hinet.bosai.go.jp/REGS/manual/dlDialogue.php?r=win32tools">win32tools</a></p><p>直接解压编译即可。</p><h2 id=tools>Tools</h2><p>win32tools 中包含了一系列用于数据处理的命令。</p><h3 id=catwin32>catwin32</h3><p><code>catwin32</code>
可以合并两个或多个 WIN32 文件，一般用于将 <strong>多个一分钟</strong> 的文件合并 <strong>一个多分钟</strong> 的文件。</p><p>用法:</p><pre><code>catwin32 File_1 File_2 ... File_n [-oOutFile | -o OutFile] [-s] [-h]
      File_n        : Input WIN32 file name
                    : You may use a wild word character.
      OutFile       : Output WIN32 file name
      -s            : Sort by date
      -h            : This usage print
</code></pre><p>示例:</p><pre><code>catwin32 20140830000*.cnt -o 2014083001.cnt
</code></pre><p>上面的示例中，会将 <code>201408300000*.cnt</code> 文件合并成 <code>2014083001.cnt</code> 文件。若数据
存在缺失，比如，缺少某些分钟的数据，或者某分钟内缺失若干秒的数据，则在使用 <code>win2sac_32</code>
将 WIN32 数据转换为 SAC 格式时，会自动对缺失的数据进行补零，因而不必担心数据缺失的问题。</p><p>关于 <code>-s</code> 选项，需要注意一下的用法：</p><ul><li>无 <code>-s</code> 的情况下， <code>catwin32</code> 会将所有的 WIN32 文件，按照 <strong>文件在参数列表中的顺序</strong> 合并在一起。</li><li>有 <code>-s</code> 的情况下， <code>catwin32</code> 会检查所有 WIN32 文件的起始时间，按照 <strong>文件的起始时间的顺序</strong> 合并在一起。</li></ul><p>比如:</p><pre><code>catwin32 201408300001.cnt 201408300002.cnt -o 2014083001_2.cnt
catwin32 201408300002.cnt 201408300001.cnt -o 2014083001_2.cnt
catwin32 201408300002.cnt 201408300001.cnt -o 2014083001_2.cnt -s
</code></pre><p>该例中，第一种方法是对的；第二种方法是错误的；第三种方法加上了 “-s” 选项是对的；</p><p>在 bash 下，形如 <code>20140830000*.cnt</code> 这样的通配符，会将当前目录下符合的所有文件按照文件名的顺序排序，并作为 catwin32 的参数，在默认的情况下，按文件名排序与按文件起始时间排序是等效的，但存在一些特殊的情况：</p><ol><li>自定义了 cnt 文件的文件名，此时在 bash 下用通配符得到的文件顺序不一定是按照时间排序的；</li><li>python 中的 <code>glob.glob()</code> 函数，默认返回的文件顺序是乱序的，需要使用 <code>sorted()</code> 函数；</li></ol><p>因而，在确保参数列表中文件顺序正确的前提下，不需要使用 “-s” 选项；反之，则必须使用 “-s” 选项，
否则在执行 <code>win2sac_32</code> 命令时会出现 “The time is not sort.” 的错误。但，加入了 “-s” 选项后，
由于需要检查每个 cnt 文件的起始时间，并按起始时间对数据进行排序，因而会影响到数据合并的
速度，尤其是在需要合并大量 cnt 文件的时候。</p><h3 id=win2sac_32>win2sac_32</h3><p><code>win2sac_32</code>：主要用于将 WIN32 格式转换为 SAC 格式。除此之外，还可以对数据进行重采样，以二进制或 ASCII 形式输出</p><h4 id=用法>用法</h4><pre><code>win2sac_32 winfile ch_no sacfile [outdir] [-p(prmfile)]
    [-e] [-b[BIN]] [-a[ASC]] [-r(RATIO)] [-m(PMAX)]
</code></pre><h4 id=对选项的说明>对选项的说明</h4><ul><li><code>winfile</code>：WIN32 格式的数据文件</li><li><code>ch_no</code>：通道号列表，多个通道号之间以逗号分隔，也可以使一个包含一系列通道号的文件名；比如 <code>4CC4</code> 或 <code>4CC4,4F73</code> 或 <code>chno.file</code> 。</li><li><code>sacfile</code>：SAC 输出文件的扩展名</li><li><code>outdir</code>：SAC 文件的输出目录。若未指定或指定为 “-”，则输出到当前目录</li><li><code>p</code> 选项：指定参数文件名 prmfile；若未使用该选项，则参数文件名默认为 “win.prm”。关于参数文件的格式，在下面会介绍。</li><li><code>e</code> 选项：设定输出 SAC 二进制文件的字节序，若不指定该选项，则输出的 SAC 二进制文件总是 big endian；若指定该选项，则输出 SAC 二进制文件的字节序由当前机器的字节序决定；</li><li><code>b</code> 选项：将数据以二进制形式输出，BIN 为文件扩展名，在不指定的情况下，默认为 “bin”</li><li><code>a</code> 选项：将数据以 ASCII 形式输出（即单列数据），ASC 为文件扩展名，在不指定的情况下，默认为 “asc”</li><li><code>r</code> 选项：对输出文件的数值乘以某常数 RATIO，在不指定的情况下，默认值为 1.0（？）</li><li><code>m</code> 选项：指定最大数据点数，默认值为 200 万；若 win32 文件中包含的数据点数超过该值，则报错。比如，一个 win32 数据中包含了所有台站一天的数据，即每个通道分别有 24*60*60*100=8640000 个点，超过默认最大点数 2000000，则此时需要使用 <code>-m</code> 选项增大最大数据点数。</li></ul><h4 id=输出文件名格式>输出文件名格式</h4><p>输出文件名格式为 <code>XXXX.Y.ZZZ</code> ，其中 <code>XXXX</code> 为台站代码， <code>Y</code> 为分量代码， <code>ZZZ</code> 为 BIN 或 ASC 或 sacfile 所指定的值。</p><h4 id=输出文件的-sac-的头段信息>输出文件的 SAC 的头段信息</h4><p>该命令在生成 SAC 文件的同时会将相关信息写入 SAC 头段中，具体如下：</p><ul><li>npts, b</li><li>leven</li><li>ievtyp, idep</li><li>nzyear, nzjday, nzhour, nzmin, nzsec, nzmsec</li><li>kstnm, kcmpnm, knetwk, cmpaz, cmpinc, stla, stlo, stel</li><li>kevnm</li></ul><p>PS：生成的 SAC 文件中头段 e 为未定义值。</p><h4 id=参数文件-prmfile-格式>参数文件 prmfile 格式</h4><p>在标准的 prmfile 中，有 16 个记录行。但 win2sac_32 程序仅使用第二行和（至？）第四行；</p><ol><li>行 1：数据文件 winfile 所在目录</li><li>行 2：channel table 文件</li><li>行 3：台站组文件名</li><li>行 4：pick 文件所在目录</li><li>行 5：hypomh 程序</li><li>行 6：hypomh 所使用的速度结构</li><li>行 7：map data file</li><li>行 8：cut-out wave data 输出目录</li><li>行 9：数据格式（B4/B2/L4/L2）</li><li>行 10：滤波设置文件</li><li>行 11：打印机&mldr;</li><li>行 12：upper/lower 半球投影</li><li>行 13：NOISE, FAR&mldr;</li><li>行 14：hypocenter 数据所在目录</li><li>行 15：打印机 DPI</li><li>行 16：临时工作目录</li></ol><p>因而一般来说，在使用 <code>win2sac_32</code> 时需要创建文件 <code>win.prm</code>，其内容为:</p><pre><code>.
./01_01_20140830.euc.ch
.
.
</code></pre><p>其中第二列为数据对应的 channel table 文件。</p><h4 id=示例>示例</h4><pre><code>win2sac_32 2000082404000101VM.cnt 4c55,4c65 sac ./sacdir -pwin.aaa.prm 1&gt;ww.tmp
</code></pre><h3 id=dewin_32>dewin_32</h3><p><code>dewin_32</code> 从 WIN32 格式文件中取出指定通道的数据。</p><p>用法:</p><pre><code>usage: dewin_32 [-m] [-s samp] [-c] [-a] [-n] [-e extend] [-f filter_file] ch_no [input_file]
        -m  Win file is minutes file.
        -s  [samp] sampling number.
        -c  character output
        -a  audio format (u-law) output
        -n  not fill absent part
        -e  [extend] file extend name
        -f  [filter_file] filter paramter file
     ch_no  channel no.(in hex.) or channel no. file name
     input_file  input win file(default=stdin)
</code></pre><p>下面解释一下几个比较重要的选项：</p><ul><li><code>input_file</code>：输入文件，为 WIN32 格式；</li><li><code>ch_no</code>：要提取的通道号列表，多个通道号之间以逗号分隔，也可以是一个包含一系列通道号的文件名；比如
<code>4CC4</code> 或 <code>4cc4,4f73</code> 或 <code>chno.file</code> 。</li><li><code>c</code> 选项：表示将数据以字符形式输出，即单列数据；</li><li><code>e</code> 选项：默认情况下，输出到标准输出；当指定多个通道时，标准输出会比较混乱，因而需要输出到文件中，该选项指定输出文件的扩展名；</li></ul><p>几个不重要的选项：</p><ul><li><code>a</code> 选项：表示将数据以音频格式输入（参见 <a href=http://www.wikiwand.com/en/%CE%9C-law_algorithm>u-law</a>）</li><li><code>n</code> 选项：若数据存在缺失，默认情况下补零输出，该选项不对缺失部分补零。</li><li><code>m</code>、<code>s</code> 选项：不是太理解，似乎都是用于数据缺失时，应该不重要；</li><li><code>f</code> 选项：后接滤波参数文件，以对输出的数据进行滤波，一般用不到；</li></ul><p>示例:</p><pre><code>dewin_32 -e dwn -c 4CC4,5B35 -m 2003070507400101VM.cnt
dewin_32 -e dwn -c -n ch.lst &lt; 2003070507400101VMs.cnt
dewin_32 -c -n 5b35 &lt;2003070507400101VMs.cnt&gt; ww5b35.dat
</code></pre><h3 id=其他>其他</h3><p>下面的一些工具应该是很少用到的：</p><ul><li><code>wadd_32</code>：合并两个 WIN32 数据，与 catwin32 有些类似，但在细节上有区别。具体不知。一般用不到。</li><li><code>wch_32</code> ：从 WIN32 文件中提取指定通道号的数据并写入到新的 WIN32 文件中</li><li><code>wck_32</code> ：似乎是用于检查 WIN32 文件的。</li><li><code>w32tow1</code>：WIN32 格式转换为 WIN 格式（WIN32 格式是根据 WIN 格式修改得到的）</li><li><code>wed_32</code> ：用于编辑 WIN32 文件</li><li><code>wchch_32</code> ：修改通道号</li></ul><h2 id=小结>小结</h2><p>在 win32tools 提供的 9 个工具中，最常用的有两个： <code>catwin32</code> 和 <code>win2sac_32</code> ，其中前者用于合并数据，后者用于格式转换。</p><h2 id=修订历史>修订历史</h2><ul><li>2014-09-07：初稿；</li><li>2014-11-03：<code>catwin32</code> 命令要使用 <code>-s</code> 选项；</li><li>2014-11-14：加入了 “生成的 SAC 文件的头段信息” 一节；</li><li>2014-12-01：对 <code>-s</code> 选项的理解错误，该选项只会对文件按照起始时间排序，不会影响到数据的补零；</li></ul></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>SeisMan</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2014-12-01</span></p></div><div class=post-reward><input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>赞赏支持</label><div class=qr-code><label class=qr-code-image for=reward><img class=image src=/images/wechatpay-qr-code.png>
<span>微信打赏</span></label>
<label class=qr-code-image for=reward><img class=image src=/images/alipay-qr-code.png>
<span>支付宝打赏</span></label></div></div><footer class=post-footer><div class=post-tags><a href=/tags/Hinet/>Hinet</a>
<a href=/tags/%E6%A0%BC%E5%BC%8F%E8%BD%AC%E6%8D%A2/>格式转换</a></div><nav class=post-nav><a class=prev href=/merge-pdf/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">Linux 下合并 PDF</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/hinet-instrumental-response/><span class="next-text nav-default">Hi-net 的仪器响应</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><div id=disqus_thread></div><script type=text/javascript>(function(){var a,b;if(window.location.hostname==='localhost')return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='seisman',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:seisman.info@gmail.com class="iconfont icon-email" title=email></a><a href=https://github.com/seisman class="iconfont icon-github" title=github></a><a href=https://movie.douban.com/people/131919859 class="iconfont icon-douban" title=douban></a><a href=https://blog.seisman.info/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动</span>
<span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2013 -
2021
<span class=heart><i class="iconfont icon-heart"></i></span>
<span class=author>SeisMan</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script><script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script><script type=text/javascript src=/lib/fancybox/jquery.fancybox-3.1.20.min.js></script><script type=text/javascript src=/dist/even.26188efa.min.js></script></body></html>